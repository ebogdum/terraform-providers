resource "aws_guardduty_malware_protection_plan" "this" {
  region = var.region
  role   = var.role

  dynamic "protected_resource" {
    for_each = var.protected_resource != null ? [var.protected_resource] : []
    content {
      dynamic "s3_bucket" {
        for_each = protected_resource.value.s3_bucket != null ? [protected_resource.value.s3_bucket] : []
        content {
          bucket_name     = s3_bucket.value.bucket_name
          object_prefixes = s3_bucket.value.object_prefixes
        }
      }
    }
  }

  dynamic "actions" {
    for_each = var.actions != null ? [var.actions] : []
    content {
      dynamic "tagging" {
        for_each = actions.value.tagging != null ? [actions.value.tagging] : []
        content {
          status = tagging.value.status
        }
      }
    }
  }

  tags = var.tags
}